<!DOCTYPE html>
<html>
	<head>
		<title>
			Videogame by Ocho
		</title>
	</head>
	<body>
		<canvas id="bg" width="960" height="640" style="border: solid 2px black; position:absolute; z-index:0;">
		</canvas>
		<canvas id="fg" width="960" height="640" style="border: solid 2px black; position:absolute; z-index:1;">
		</canvas>
		<script>

			// Initialization
			var bg = document.getElementById('bg');
			var ctxbg = bg.getContext('2d');
			var fg = document.getElementById('fg')
			var ctxfg = fg.getContext('2d')
			var tileset = new Image();
			var xvalue;
			var yvalue;
			var imgLoaded = false;
			var keys = new Array(250);
			var tiles = new Array(600);
			for ( var i = 0; i < tiles.length; i++ ) {
				tiles[i] = new Array(20);
			}


			// Tile Prototype
			function Tile(sx, sy){
				this.sx = sx;
				this.sy = sy;
				this.sw = 32;
				this.sh = this.sw;
				this.dw = this.sw;
				this.dh = this.sh;
			};
			Tile.prototype.draw = function() { }


			// Player Prototype
			function Player() {
				this.x = this.y = 400;
				this.width = this.height = 100;
				this.velY = this.velX = 0;
				this.speed = 2;
				this.frictionX = 0.88;
				this.frictionY = 0.88;
				this.model = new Image();
				this.model.src = 'ham.png';
				this.model.onload = function() {
					imgLoaded = true;
				}
				this.jumping = false;
				this.mass = 1;
				this.accel = 9.8 / 60;
			}

			Player.prototype.draw = function() {
				fg.width = fg.width;
				if (imgLoaded) ctxfg.drawImage(this.model, this.x, this.y);

			}
			var self;
			var dirInterval;
			document.body.addEventListener("keydown", function( e ) {
				if (e.keyCode == 37 ||e.keyCode == 38 || e.keyCode == 39 || e.keyCode == 40)
					e.preventDefault();
				console.log(e.keyCode);
				keys[e.keyCode] = true;
			});
			document.body.addEventListener("keyup", function( e ) {
				keys[e.keyCode] = false;
			});
			var t = 0;
			Player.prototype.update = function() {
				t += 1/60;
			    if (keys[38]) {
			        if (this.velY > -this.speed) {
			            this.velY--;
			        }
			        if ( this.jumping == false ) {
			        	t = 0;
			        	this.velY = -20;
			        	this.jumping = true;
			        }
			    }
			    if (keys[40]) {
			        if (this.velY < this.speed) {
			            this.velY++;
			        }
			    }
			    if (keys[39]) {
			        if (this.velX < this.speed) {
			            this.velX++;
			        }
			    }
			    if (keys[37]) {
			        if (this.velX > -this.speed) {
			            this.velX--;
			        }
			    }

			    this.velX *= this.frictionX;
			    this.x += this.velX;
			    this.velY *= this.frictionY;
			    if ( this.jumping ) {
			    	this.velY = this.velY + 9.8 * t;
			    }
			    this.y += this.velY;
			    if ( this.y >= fg.height - this.height ) {
			    	this.y = fg.height - this.height;
			    	this.jumping = false;
			    }
			}
			var p1 = new Player();
			function gameLoop() {
				p1.draw();
				p1.update();
				console.log('jumping: ' + p1.jumping);
			}
			setInterval(gameLoop, 1000 / 60)
		</script>
	</body>
</html>
