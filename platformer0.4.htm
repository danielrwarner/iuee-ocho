<!DOCTYPE html>
<html>
	<head>
		<title>
			Videogame by Ocho
		</title>
	</head>
	<body>
		<canvas id="bg" width="960" height="640" style="border: solid 2px black; position:absolute; z-index:0;">
		</canvas>
		<canvas id="fg" width="960" height="640" style="border: solid 2px black; position:absolute; z-index:1;">
		</canvas>
		<script>
			var bg = document.getElementById('bg');
			var ctxbg = bg.getContext('2d');
			var fg = document.getElementById('fg')
			var ctxfg = fg.getContext('2d')
			var tileset = new Image();
			var xvalue;
			var yvalue;

			var tiles = new Array(600);
			for ( var i = 0; i < tiles.length; i++ ) {
				tiles[i] = new Array(20);
			}

			function Tile(sx, sy){
				this.sx = sx;
				this.sy = sy;
				this.sw = 32;
				this.sh = this.sw;
				this.dw = this.sw;
				this.dh = this.sh;
			};
			Tile.prototype.draw = function() {

			}


			function Player() {
				this.x = this.y = 0;
				this.width = this.height = 100;
				this.model;
				this.mass = 1;
				this.accel = 9.8;
			}

			Player.prototype.spawn = function() {
				fg.width = fg.width;
				myImage = new Image();
				myImage.src = 'ham.png';
				var self = this;
				myImage.onload = function () {
					console.log("this.x: " + this.x + ", this.y: " + this.y);
					ctxfg.drawImage(myImage, self.x, self.y);
				}

			}
			var dirInterval;

			Player.prototype.initControls = function() {
				var self = this;
				window.onkeyup = function ( e ) {
					if ( e.which == 37 || e.which == 38 || e.which == 39 ||  e.which == 40 ) {
						e.preventDefault();
						clearInterval(dirInterval);
						dirInterval = null;
						console.log("keyup");
					}
				}
				window.onkeydown = function( e ) {
					if ( e.which == 37 || e.which == 38 || e.which == 39 ||  e.which == 40 )
						e.preventDefault();
					console.log("key: " + e.which);
						fg.width = fg.width;
						var newVal;
						switch ( e.which ) {
							case 37:
								if ( !dirInterval ) {
									console.log("dirInterval: " + dirInterval);
									dirInterval = setInterval(function() {
										newVal = self.x - 5;
										if (newVal <= fg.width - self.width)
											self.x = newVal;
										console.log("keydown");

									}, 1000 / 60 );
								}
								break;
							case 38:
								newVal = self.y - 20;
								if (newVal >= 0)
									self.y -= 20;
								break;
							case 39:
								if ( !dirInterval ) {
									dirInterval = setInterval(function() {
										newVal = self.x + 5;
										if (newVal >= 0)
											self.x = newVal;
										console.log("keydown");

									}, 1000 / 60 );
								}
								break;
							case 40:
								newVal = self.y + 20;
								if (newVal <= fg.height - self.height)
									self.y += 20;
								break;
						}
						console.log( self.x + " " + self.y);
						myImage2 = new Image();
						myImage2.src = 'ham.png';
						myImage2.onload = function () {
							ctxfg.drawImage(myImage2, self.x, self.y);
						}

				}
			}
			var counter = 0;

			var t = new Array(88);
			for (var i = 0; i < 8; i++){
				for (var j = 0; j < 11; j++, counter++){
						t[counter] = new Tile(i *32, j * 32) // another error here
				};
			};
			


			tileset.src = 'tileset.png';
			var gravity;
			tileset.onload = function() {
				var p1 = new Player();
				var y, t = 0;
				p1.spawn();
				gravity = setInterval(function () {

					y = 10 * p1.accel * t * t;
					t += 1/60;
					p1.y = y;
					p1.spawn();
					// console.log("p1.y: " + p1.y);
					// console.log("fg.height: " + fg.height);
					if ( p1.y >= fg.height - p1.height ) {
						console.log('hihi');
						p1.y = fg.height - p1.height;
					}
				}, 1000 / 60 );

				p1.initControls();
				for (var row = 0; row < 20; row++){
					yvalue = (row * 32);
					for (var column = 0; column < 30; column++) {
						xvalue = (column * 32);
						ctxbg.drawImage(tileset, sx=0, sy=24, sWidth=32, sHeight=32, dx=xvalue, dy=yvalue, dWidth=32, dHeight=32);
					};
				};

				for (var lines = 0; lines < 30; lines++) {
				xvalue = (lines * 32);
				
				ctxfg.drawImage(tileset, sx=0, sy=0, sWidth=32, sHeight=32, dx=xvalue, dy=192, dWidth=32, dHeight=32);
				ctxfg.drawImage(tileset, sx=0, sy=160, sWidth=32, sHeight=32, dx=xvalue, dy=224, dWidth=32, dHeight=32);
				};
			};
		</script>
	</body>
</html>
